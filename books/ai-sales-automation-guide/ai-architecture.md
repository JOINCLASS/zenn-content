---
title: "AI営業自動化の技術アーキテクチャ"
---

## 本章の対象読者

本章は、メール解析AIの裏側にある技術的な仕組みに興味がある方を対象としています。前章までの内容を実践するだけであれば、本章を読む必要はありません。

ただし、自社でAI営業ツールを開発したい方、あるいは導入検討にあたって技術的な信頼性を評価したい方にとっては、アーキテクチャの理解が判断材料になるはずです。

## 全体アーキテクチャの概要

AI営業自動化ツールの技術構成は、大きく4つのレイヤーに分かれます。

```
┌────────────────────────────────────────────┐
│  プレゼンテーション層                         │
│  （Web UI / カンバンボード / メール送信画面）    │
├────────────────────────────────────────────┤
│  アプリケーション層                           │
│  （商談管理 / 日程調整 / テンプレートエンジン）   │
├────────────────────────────────────────────┤
│  AI処理層                                    │
│  （メール解析 / 情報抽出 / 構造化変換）         │
├────────────────────────────────────────────┤
│  インフラ層                                   │
│  （Gmail API / Calendar API / データベース）    │
└────────────────────────────────────────────┘
```

各レイヤーの役割と、レイヤー間のデータの流れを順に解説します。

## メール受信パイプライン

メール転送による商談自動登録の技術的な流れを説明します。

### ステップ1：メールの受信

ユーザーがメールを転送すると、以下のいずれかの方法でシステムがメールを受信します。

**方式A：専用受信アドレス**

サービスが発行する専用のメールアドレス（例：`inbox-xxxx@service.example.com`）宛にメールが転送されます。メールサーバーがこのアドレスへの着信を検知し、処理パイプラインが起動します。

**方式B：Gmail API連携**

ユーザーのGmailアカウントとOAuth認証で連携し、特定のラベルやフィルタに該当するメールを自動取得します。Gmail APIのPush通知（Pub/Sub）を利用すれば、メール着信をほぼリアルタイムで検知できます。

### ステップ2：メール本文の前処理

受信したメールは、AI処理の前にクリーニングが必要です。

- **HTMLタグの除去**: HTMLメールからプレーンテキストを抽出
- **署名ブロックの分離**: メール本文と署名を分離して、それぞれから情報を抽出
- **引用部分の除去**: 転送時に含まれる過去のやりとりをフィルタリング
- **エンコーディングの正規化**: ISO-2022-JPやShift_JISなど日本語メール特有のエンコーディングを処理

### ステップ3：LLMによる情報抽出

前処理されたテキストをLLM（大規模言語モデル）に投入し、構造化データを抽出します。

```json
{
  "company_name": "株式会社サンプル",
  "contact_name": "田中太郎",
  "contact_email": "tanaka@sample.co.jp",
  "contact_phone": "03-1234-5678",
  "preferred_dates": [
    "2026-02-24T00:00:00+09:00",
    "2026-02-25T00:00:00+09:00"
  ],
  "summary": "Webサイトリニューアルに関する相談"
}
```

ここで重要なのはプロンプト設計です。LLMに対して「何を抽出すべきか」を明確に指示し、出力フォーマットを規定することで、安定した構造化データが得られます。

### ステップ4：バリデーションと登録

LLMの出力はそのまま信用せず、バリデーション（妥当性検証）を行います。

- メールアドレスの形式チェック（RFC 5322準拠）
- 電話番号の桁数・形式チェック
- 日付の論理チェック（過去日でないか、非営業日でないか）
- 会社名の最低文字数チェック

バリデーションを通過したデータが、データベースに商談（ディール）として登録されます。

## LLMの選択と最適化

メール解析に使用するLLMの選択は、精度・コスト・速度のバランスで決まります。

### モデル選択の考慮点

| 要素 | 大規模モデル | 軽量モデル |
|------|------------|-----------|
| 精度 | 高い | やや劣る |
| レイテンシ | 数秒 | 数百ミリ秒 |
| コスト/リクエスト | 高い | 安い |
| 複雑なメール対応 | 得意 | 苦手な場合あり |

営業メールの情報抽出は、タスクとしてはそれほど複雑ではありません。定型的なビジネスメールであれば、軽量モデルでも十分な精度が得られます。ただし、複数の候補日が複雑な表現で記述されている場合や、本文に案件の詳細が長文で書かれている場合は、大規模モデルのほうが安定します。

### プロンプトエンジニアリングのポイント

メール解析の精度を高めるためのプロンプト設計のポイントは以下のとおりです。

1. **出力フォーマットを厳密に指定する**: JSON Schemaで構造を定義し、フィールドごとの型と制約を明示する
2. **抽出対象を列挙する**: 「会社名」「担当者名」「メールアドレス」「電話番号」「希望日時」「案件概要」を明示的にリストする
3. **判断に迷った場合のルールを決める**: 情報が見当たらない場合は `null` を返す。推測しない
4. **日本語特有のパターンに対応する**: 「株式会社」「有限会社」「合同会社」の位置が社名の前後どちらにも来ることへの対応

## Google Calendar連携の技術

### OAuth 2.0認証フロー

Google Calendar APIを利用するためには、ユーザーの承認（OAuth 2.0）が必要です。

```
ユーザー → 認証画面（Googleログイン）→ 権限の承認
    ↓
アクセストークン取得
    ↓
Calendar APIへのリクエスト（空き時間の取得、予定の作成）
```

要求する権限（スコープ）は最小限に抑えることが重要です。

- `calendar.readonly`: カレンダーの読み取り（空き時間の確認）
- `calendar.events`: 予定の作成・編集

### 空き時間の算出ロジック

日程調整リンクで表示される空き時間は、以下のロジックで算出されます。

1. 連携されたすべてのカレンダーから、指定期間の予定を取得
2. 予定のある時間帯をブロック
3. 営業時間外（設定値）をブロック
4. バッファ時間（設定値）を予定の前後に付加
5. 残った時間帯を「空き」として候補に表示

この計算はリンクがアクセスされるたびにリアルタイムで実行されるため、別のチャネルで入った予定も即座に反映されます。

### 予定の自動作成

相手が日時を選択すると、Calendar APIの `events.insert` エンドポイントを呼び出し、Googleカレンダーに予定を自動作成します。

同時に、選択された時間帯は他の候補から即座に除外されるため、ダブルブッキングが物理的に発生しません。

## データベース設計の概要

AI営業自動化ツールのデータモデルは、主に以下のエンティティで構成されます。

```
User（ユーザー）
 ├── Organization（組織・チーム）
 ├── Deal（商談・案件）
 │    ├── Contact（連絡先）
 │    ├── Activity（活動履歴）
 │    └── Email（メール送受信履歴）
 ├── EmailTemplate（メールテンプレート）
 └── CalendarConnection（カレンダー連携情報）
```

### 商談（Deal）の状態管理

カンバンボードのステージは、商談レコードの `status` フィールドで管理されます。

```
LEAD → CONTACTED → MEETING_SCHEDULED → MEETING_DONE
  → PROPOSAL_SENT → NEGOTIATION → WON / LOST
```

ステータスの変更履歴は Activity として記録され、「いつ」「誰が」「どのステージに」移動させたかのログが残ります。

## セキュリティアーキテクチャ

営業データは企業にとって極めて重要な情報です。セキュリティの設計が不十分なツールは、いかに便利でも採用すべきではありません。

### 認証

- **Google OAuth 2.0**: パスワードの保存を行わず、Googleの認証基盤に委任
- **JWT（JSON Web Token）**: API認証にJWTを使用し、セッション管理をステートレスに

### 暗号化

- **通信の暗号化**: すべての通信はTLS 1.2以上で暗号化
- **保存データの暗号化**: データベース内の機密フィールド（メールアドレス、電話番号等）はAES-256で暗号化

### アクセス制御

- **ロールベースアクセス制御（RBAC）**: オーナー・管理者・メンバーの3段階で権限を管理
- **組織間のデータ分離**: マルチテナントアーキテクチャにおいて、組織間のデータアクセスを厳密に制御

### 第三者認証

信頼性の客観的な証明として、セキュリティの第三者認証を取得しているかを確認することが重要です。

**CASA（Cloud Application Security Assessment）Tier 2** は、Googleが定める App Defense Allianceのセキュリティ評価フレームワークです。OAuth連携するアプリケーションに対して、Googleの基準でセキュリティを評価・認証します。

この認証を取得しているツールは、Google OAuth連携のセキュリティが第三者によって検証されていることを意味します。

## システムの信頼性

### エラーハンドリング

メール解析AIは100%の精度を保証するものではありません。そのため、以下のフォールバック設計が重要です。

1. **LLM抽出失敗時**: 手動入力画面にフォールバック。ユーザーに抽出できなかったことを通知
2. **API障害時**: リトライキュー（指数バックオフ）で自動再試行。3回失敗で手動対応に切り替え
3. **データ不整合時**: バリデーションエラーのフィールドだけをユーザーに修正依頼

### 可用性

- **レスポンスタイム**: メール転送から案件登録完了まで10秒以内（目標値）
- **可用性SLA**: 99.9%（月間ダウンタイム43分以内）
- **バックアップ**: 日次の自動バックアップと、任意時点への復元機能

## まとめ

本章のポイントを整理します。

- AI営業自動化ツールは「プレゼンテーション」「アプリケーション」「AI処理」「インフラ」の4層で構成
- メール解析はLLMによる構造化データ抽出で実現。プロンプト設計とバリデーションが精度の鍵
- Google Calendar連携はOAuth 2.0認証とリアルタイム空き時間算出で実装
- セキュリティはOAuth認証・TLS暗号化・RBAC・第三者認証（CASA Tier 2等）の多層防御
- エラーハンドリングとフォールバック設計により、AIの不完全性を補完

次章では、営業自動化を段階的に導入するための12週間のステップバイステップガイドを提供します。
